<!doctype html>
<html lang="{{get_locale()}}">
<head>
    <meta charset="utf-8">

    <title>{{branding['name']}}</title>
    <meta name="description" content="">
    <meta name="author" content="">


    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.scss.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/graph.scss.css') }}">

</head>

<body>
    {#
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
        <a class=" navbar-brand" href="#">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="logo" style="width:100px;">
        </a>

        <div class="navbar-collapse" id="main-navigation">
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Vaalipiirit</a>
                    <ul class="dropdown-menu">
                        <li><a href="#" class="small" data-value="option1" tabIndex="-1"><input
                                    type="checkbox" />&nbsp;Vaalipiiri A</a></li>
                        <li><a href="#" class="small" data-value="option2" tabIndex="-1"><input
                                    type="checkbox" />&nbsp;Vaalipiiri B</a></li>
                        <li><a href="#" class="small" data-value="option3" tabIndex="-1"><input
                                    type="checkbox" />&nbsp;Vaalipiiri C</a></li>
                    </ul>
                </li>

                <li class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Puolueet</a>
                    <ul class="dropdown-menu">
                        <li><a href="#" class="small" data-value="option1" tabIndex="-1"><input
                                    type="checkbox" />&nbsp;Puolue A</a></li>
                        <li><a href="#" class="small" data-value="option2" tabIndex="-1"><input
                                    type="checkbox" />&nbsp;Puolue B</a></li>
                        <li><a href="#" class="small" data-value="option3" tabIndex="-1"><input
                                    type="checkbox" />&nbsp;Puolue C</a></li>
                    </ul>
                </li>
        </div>
    </nav>
    #}

    {% if dev %}
        {% include 'force-control.html' %}
    {% endif %}
    <div id="graph">
        <svg class="graph">
            <g class="bg">
                <text>{{branding['name']}}</text>
                <line x1="-6em" y1="0" x2="6em" y2="0" />
                <line x1="-6em" y1="0" x2="6em" y2="0" />
            </g>
        </svg>
        <div id="overlay">
        {{_("Derepublicing")}}
        </div>
    </div>
<script>
(function() {
    {# Set graph size early #}
    const width = parseInt(window.innerWidth),
          height = parseInt(window.innerHeight);
    let svg = document.querySelector("svg.graph");
    svg.setAttribute('width', width);
    svg.setAttribute('height', height);

    let g = svg.querySelector(".bg");
    let t = g.querySelector("text");
    const w = t.getBBox();

    const _w = w.width/2;
    const _h = w.height/2;

    t.setAttribute("x", -_w);
    t.setAttribute("y", -_h);

    let ls = g.getElementsByTagName("line");
    for(e of ls) {
        e.setAttribute("x1", -_w - _w/20);
        e.setAttribute("x2", _w + _w/20);
    }
    ls[0].setAttribute("y1", -_h + _h/4);
    ls[0].setAttribute("y2", -_h + _h/4);

    ls[1].setAttribute("y1", -_h*2 - _h /3);
    ls[1].setAttribute("y2", -_h*2 - _h /3);

    const r = Math.min(width/w.width, height/w.height);

    g.setAttribute("transform", "translate("+width/2+","+height/2+") scale("+r/3+")");
    g.setAttribute("y", parseInt(height / 2))
})();

</script>

<script src="https://d3js.org/d3.v4.js"></script>
<script src="{{url_for('static', filename='graph.js')}}"></script>
<script>
var parties = [];

var default_image = {{url_for("static", filename="default-person.png")|tojson|safe}}

d3.json('{{url_for(".data_parties")}}', function(err, data) {
    if (err) throw err;
    parties = data;
    graph_run();
});
d3.json('{{url_for(".data_nodes")}}', function(err, data) {
    if (err) throw err;
    process_nodes(data)
    graph_run();
});
d3.json('{{url_for(".data_links")}}', function(err, data) {
    if (err) throw err;
    process_links(data);
    graph_run();
});
    </script>
    {#
    <footer class="page-footer bg-dark text-white">
        <div class="footer-copyright text-center color"> Agora Analytica 2019 -
            <a href="https://opensource.org/licenses/MIT"> MIT-lisenssi</a>
        </div>
    </footer>
    #}



    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
</body>

</html>